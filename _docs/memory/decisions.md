# Decision Log

This file records architecture and implementation decisions. Entries are append-only.

---

<!-- New entries are added below this line -->

## 2026-02-05: task-list.json Schema Design and References Field

**Context**: Reviewed task-list.json template design origins and compared against alternative task list structures (single Markdown, chunked Markdown). Evaluated potential schema enhancements for autonomous development support.

**Schema Origin**: Best Practices Manual Section 3.3 "Feature List Management" with adaptations:

| Manual (Feature List) | Scaffold (Task List) | Rationale |
|----------------------|---------------------|-----------|
| `passes: boolean` | `status: enum` | Tasks need multiple states (pending/in-progress/complete) |
| `lastTestedAt` | `completedAt` | Renamed for task semantics |
| `steps: array` | Removed | Steps generated by task-planner agent |
| `category` | Removed | Priority field handles ordering |
| — | `title` | Added for display |
| — | `acceptanceCriteria` | Added for test-writer input |

**Decision**: Add `references` field to task schema. Reject `phase`, `effort`, and `filesAffected` fields.

**Analysis** (fields evaluated against autonomous development value):

| Field | Proposed Purpose | Verdict |
|-------|-----------------|---------|
| `phase` | Group tasks into milestones | Rejected: `blockedBy` enforces sequencing; phases are human organization |
| `effort` | S/M/L estimates | Rejected: Does not guide autonomous execution |
| `references` | Paths to relevant documentation | **Accepted**: Tells agent where to find design constraints |
| `filesAffected` | Pre-specify files to modify | Rejected: Duplicates task-planner output; may constrain exploration |

**Implementation**:
- Added `references` field to `_docs/templates/task-list.json`
- Updated `task-selector` agent to include references in output
- Updated `task-planner` agent to read references as priority context
- Updated `task-list-protection` rule to mark references as immutable

**Format Decision**: JSON over Markdown per manual guidance ("less susceptible to inappropriate changes"). Enables machine-readable consumption by task-selector agent.

**Rejected Alternatives**:
- Chunked Markdown: Requires multi-file reads, navigation overhead
- Single Markdown: Not machine-readable, prone to accidental modification
- Markdown source + JSON generated: Two sources of truth, sync overhead

---

## 2026-02-03: Git Hooks for Commit Logging and Bypass Detection

**Context**: Evaluated ai-project-template's pre-commit and post-commit git hooks to assess adoption benefit for scaffold.

**Source Analysis**:

| ai-project-template Feature | Lines | Purpose |
|----------------------------|-------|---------|
| Pre-commit Claude Review | ~600 | Runs `claude --print` for non-interactive code review |
| Review Cache | ~200 | Hash-based caching with dependency tracking |
| AUTO_ACCEPT Validation | ~100 | Validates retry commits; blocks if content changed |
| Session State | ~50 | JSON session file tracks approval status |
| Post-commit Logging | ~100 | Logs commits, detects `--no-verify` bypass |
| Post-commit Cleanup | ~80 | Removes stale session files |

**Decision**: Adopt simplified commit logging and bypass detection only. Do not adopt pre-commit Claude review or review cache.

**Analysis**:
- ai-project-template uses non-interactive `claude --print` workflow; our scaffold uses interactive skill-based workflow with subagents
- Pre-commit Claude review would duplicate our `/commit` skill + `code-reviewer` subagent
- Review cache is complex (~200 lines with dependency tracking); our subagent isolation already handles context
- AUTO_ACCEPT validation solves a problem specific to non-interactive CI workflows
- Commit logging and bypass detection provide value without workflow conflict

**Implementation**:
- Enhanced `_scripts/pre-commit` - added marker file creation for bypass detection
- Created `_scripts/post-commit` - logs commits, detects `--no-verify` bypass
- Installation: `git config core.hooksPath _scripts`
- Logs written to `_logs/all-commits.log` and `_logs/commit-bypasses.log`

**Merge Decision**: Discovered existing `_scripts/pre-commit` with quality gates (test, lint, typecheck). Merged bypass detection into existing hook rather than creating separate `scripts/git-hooks/` directory. Single hook location is cleaner.

**Rejected Alternatives**:
- Full pre-commit Claude review: Would conflict with `/commit` + `code-reviewer` workflow
- Review cache: Over-engineered for our interactive workflow
- AUTO_ACCEPT pattern: Specific to non-interactive CI; not applicable
- Separate `scripts/git-hooks/` directory: Redundant; merged into existing `_scripts/`

---

## 2026-02-03: Active Context Section in progress.md (Memory System Enhancement)

**Context**: Evaluated whether scaffold would benefit from adopting a 6-file granular Memory Bank (projectBrief, productContext, systemPatterns, techContext, activeContext, progress) like the ai-project-template repository.

**Decision**: Add Active Context section to progress.md instead of adopting 6-file granular Memory Bank.

**Analysis**:
- ai-project-template's 6-file structure compensates for lack of subagent isolation (Cursor context)
- Our scaffold already has 6 specialized subagents that isolate context (task-selector, memory-updater, etc.)
- Adding mandatory files would increase session-start token cost
- Best practices manual emphasizes minimal CLAUDE.md (<60 lines) and progressive disclosure
- Session summaries already handle cross-session continuity
- Gap identified: no persistent "current focus" tracking between sessions

**Implementation**:
- Added Active Context section at top of progress.md (replaced on each update, not appended)
- Updated memory-updater agent to maintain Active Context section
- Updated /dev skill to report from Active Context at session start
- Session Log section remains append-only below Active Context

**Structure**:
```
progress.md
├── Active Context (REPLACED on each update)
│   ├── Current Focus
│   ├── Current Task
│   ├── Recent Decisions
│   └── Immediate Next Steps
└── Session Log (APPEND-only)
    └── Timestamped entries
```

**Rejected Alternative**: Adopting 6-file granular Memory Bank. Would add overhead without solving problems our subagent architecture already handles.

---

## 2026-01-26: Environment Setup via Task List (R5 Resolution)

**Context**: Evaluated R5 recommendation to extract `/init` into a dedicated initializer subagent, based on Anthropic's "two-agent architecture" pattern.

**Decision**: Remove `/init` command entirely; handle setup through standard task list.

**Analysis**:
- Anthropic's initializer agent (from "Effective harnesses for long-running agents") is designed for autonomous spec-to-feature decomposition
- Our workflow assumes human-provided documentation (prd.md, architecture.md, task-list.json)
- The "pure coordinator" principle cited in the recommendation is from practitioner literature, not official Anthropic guidance
- Environment setup in our scaffold is validation-based, not generative

**Implementation**:
- `/dev` skill handles fresh project state (missing memory files)
- `task-list.json` template includes setup tasks as TASK-001 through TASK-003
- All tasks flow through standard loop: /next → /plan → /implement → /review

**Rejected Alternative**: Extracting setup to subagent would add complexity without capability gain.

---
