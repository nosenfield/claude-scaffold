---
paths:
  - "_docs/task-list.json"
  - "**/task-list.json"
---

# Task List Protection Rules

The task list is the authoritative source for project work items. It must remain stable to ensure reliable progress tracking across sessions.

## Schema Versions

| Version | Status Field Values | Key Differences |
|---------|---------------------|-----------------|
| 1.x | pending, in-progress, complete | Legacy schema |
| 2.x | blocked, eligible, in-progress, complete, failed | Parallel execution support |

## Immutable Fields

NEVER modify these fields on any task:
- `id`: Task identifier
- `title`: Task name
- `description`: Task details
- `priority`: Task ordering
- `executionWave`: DAG depth level (v2.x)
- `acceptanceCriteria`: Definition of done
- `references`: Documentation pointers for agent context
- `filesTouched`: File paths for contention detection (v2.x)
- `affectedPaths`: File paths for batch parallelization (v1.x)
- `blockedBy`: Dependency list

## Mutable Fields

ONLY these fields may be modified:
- `status`: Task execution state
- `assignedAgent`: Agent instance ID (v2.x)
- `result`: Structured completion output (v2.x)
- `completedAt`: ISO timestamp when status becomes "complete"

## Allowed Operations

| Operation | Permitted | Actor |
|-----------|-----------|-------|
| Read task list | Yes | Any agent |
| Update status field | Yes | Orchestrator, task-selector, memory-updater |
| Update assignedAgent field | Yes | Orchestrator (batch-execute-task-auto) |
| Update result field | Yes | memory-updater |
| Update completedAt field | Yes | memory-updater |
| Regenerate waveSummary | Yes | /compute-waves only |
| Add new task | No | User only (manual edit, then run /compute-waves) |
| Remove task | No | User only (manual edit, then run /compute-waves) |
| Modify task details | No | User only (manual edit, then run /compute-waves) |

## Status Transitions (v2.x - Wave Execution)

```
blocked → eligible     (orchestrator activates wave)
eligible → in-progress (orchestrator dispatches task)
in-progress → complete (memory-updater on success)
in-progress → failed   (memory-updater on failure)
failed → eligible      (orchestrator retry within wave)
```

## Status Semantics (v2.x)

| Status | Meaning |
|--------|---------|
| blocked | Task is in a future wave. Activated when wave begins. |
| eligible | Task is in current wave and eligible for dispatch to an agent. |
| in-progress | Task dispatched to agent. |
| complete | Agent reported success. |
| failed | Agent reported failure. May be retried within wave. |

## Status Transitions (v1.x - Legacy)

```
pending → in-progress    (via /next-from-task-list or /batch-execute-task-auto)
in-progress → complete   (via /commit-task or memory-updater in batch mode)
in-progress → pending    (if task fails in batch mode, or abandoned with user approval)
```

## Computed Fields

These fields are regenerated by `/compute-waves`:
- `waveSummary` (root level): Pre-computed execution waves
- `executionWave` (per task): DAG depth level

After manual task list edits (adding/removing tasks, changing blockedBy), run `/compute-waves` to regenerate.

## Result Object

The `result` field (v2.x) stores structured completion data:

```json
{
  "status": "success | failure",
  "summary": "Brief description",
  "filesModified": ["actual files changed"],
  "blockers": ["issues if failed"]
}
```

This field:
- Is written by memory-updater after task completion
- May be cleared by orchestrator on retry
- Should be preserved for audit trail after batch completion

## Validation

Before any write to task-list.json:
1. Parse existing JSON
2. Identify changed fields
3. Reject if immutable field modified
4. Reject if status transition invalid
5. Proceed only if changes are permitted

## Version Migration

To migrate from v1.x to v2.x:
1. Rename `affectedPaths` to `filesTouched`
2. Change `pending` status to `blocked` or `eligible` based on dependencies
3. Add `assignedAgent: null` and `result: null` to each task
4. Run `/compute-waves` to generate `waveSummary` and `executionWave`
